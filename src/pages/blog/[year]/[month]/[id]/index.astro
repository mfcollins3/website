---
import BaseLayout from '../../../../../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';
import { getCollection, render } from 'astro:content';
import dayjs from "dayjs";
import utc from "dayjs/plugin/utc";

dayjs.extend(utc);

export async function getStaticPaths() {
  const posts = await getCollection('blog', (post) => import.meta.env.PROD ? !post.data.draft : true);
  return posts.map((post) => {
    const parts = post.id.split('/');
    const year = parts[0];
    const month = parts[1];
    const id = parts[2];
    return {
      params: { year, month, id },
      props: { post },
    };
  });
}

const { post } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(post);

const formattedDate = post.data.publishedDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
const lastModified = dayjs(remarkPluginFrontmatter.lastModified)
  .utc()
  .tz("America/Phoenix")
  .format('MMMM DD, YYYY hh:mm A Z');
---

<BaseLayout
  title={`${post.data.title} | Michael F. Collins, III`}
  description={post.data.excerpt}
>
  <div class="min-h-screen bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <a
        href="/blog"
        class="inline-flex items-center gap-2 text-[#87ceeb] hover:text-[#87ceeb]/80 mb-8 transition-colors duration-200"
      >
        ‚Üê Back to Blog
      </a>

      <article class="bg-white rounded-lg shadow-md overflow-hidden">
        <!-- Featured Image -->
        {post.data.featuredImage && (
          <div class="relative h-96 overflow-hidden">
            <Image
              src={post.data.featuredImage}
              alt={post.data.title}
              class="w-full h-full object-cover"
            />
          </div>
        )}

        <!-- Content -->
        <div class="p-8 md:p-12">
          <div class="flex items-center gap-4 text-sm text-gray-600 mb-6">
            <span>{formattedDate}</span>
            <span class="flex items-center gap-1">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
              </svg>
              {remarkPluginFrontmatter.minutesRead}
            </span>
          </div>

          <h1 class="text-4xl font-bold text-gray-900 mb-6">
            {post.data.title}
          </h1>

          <p class="text-xl text-gray-600 mb-8 italic">
            {post.data.excerpt}
          </p>

          <div class="prose max-w-none text-gray-700 leading-relaxed mb-8
            prose-headings:text-gray-900 prose-a:text-[#87ceeb]
            prose-code:bg-gray-100 prose-code:px-1 prose-code:rounded
            prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:leading-[1.2]
            [&_pre_code]:bg-transparent [&_pre_code]:p-0 [&_pre_code]:rounded-none [&_pre_code]:leading-[1.2]">
            <Content />
          </div>

            <p class="text-sm text-gray-500">
              Last modified: {lastModified}
            </p>

          <!-- Tags -->
          {post.data.tags.length > 0 && (
            <div class="border-t border-gray-200 pt-6">
              <div class="flex items-start gap-2">
                <svg class="w-5 h-5 text-gray-600 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                </svg>
                <div class="flex flex-wrap gap-2">
                  {post.data.tags.map((tag: string) => (
                    <span class="px-3 py-1 bg-[#e0f2fe] text-gray-800 rounded-full text-sm">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          )}

          <!-- Categories -->
          {post.data.categories.length > 0 && (
            <div class="mt-4">
              <div class="flex items-center gap-2 text-sm text-gray-600">
                <span class="font-medium">Categories:</span>
                <span>{post.data.categories.join(', ')}</span>
              </div>
            </div>
          )}
        </div>
      </article>
    </div>
  </div>
</BaseLayout>
